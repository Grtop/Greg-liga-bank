"use strict";!function(){function n(e,t){var r=new XMLHttpRequest;return r.responseType="json",r.timeout=1e4,r.addEventListener("load",function(){200===r.status?e(r.response):t("Статус ответа "+r.status)}),r}var i="https://echo.htmlacademy.ru";window.data={load:function(e,t,r){var a=n(t,r);a.addEventListener("error",function(){r("Ошибка соединения..")}),a.addEventListener("timeout",function(){r("Запрос не успел выполниться за "+a.timeout+"мс")}),a.open("GET",e),a.send()},send:function(e,t,r){var a=n(t,r);a.open("POST",i),a.send(e)}}}(),window.addEventListener("load",function(){document.querySelector(".nojs").classList.remove("nojs"),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var r,a;if(null===this)throw new TypeError(" this is null or not defined");var n=Object(this),i=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(r=t),a=0;a<i;){var o;a in n&&(o=n[a],e.call(r,o,a,n)),a++}}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e});var e="nav-user__signin",t="header__nav-toggle",r="service-item__head",a=document.querySelector("."+e);a&&a.addEventListener("click",function(e){e.preventDefault(),window.modal.open("modal-overlay","modal-login"),window.signin.init("modal-login","login-name","login-password")});function n(e){e.preventDefault(),l.forEach(function(e){e.parentNode.classList.remove(i.tab+"_active")});var t=e.currentTarget;t.classList.contains(r)&&t.parentNode.classList.add(i.tab+"_active")}var i={tabList:"services__list",tab:"service-item"},o=document.querySelector("."+t);if(o&&o.addEventListener("click",function(e){e.preventDefault();var t=document.querySelector(".nav-main");if(e.target.classList.contains("header__nav-toggle")){if(e.target.classList.contains("header__nav-toggle_closed"))return e.target.classList.remove("header__nav-toggle_closed"),e.target.classList.add("header__nav-toggle_opened"),t.classList.remove("nav-main_closed"),t.classList.add("nav-main_opened"),void(document.body.style.overflow="hidden");if(e.target.classList.contains("header__nav-toggle_opened"))return e.target.classList.remove("header__nav-toggle_opened"),e.target.classList.add("header__nav-toggle_closed"),t.classList.remove("nav-main_opened"),t.classList.add("nav-main_closed"),void(document.body.style.overflow="scroll")}}),1008<document.body.offsetWidth){var l=document.querySelectorAll("."+r);0<l.length&&l.forEach(function(e){e.addEventListener("click",n),e.addEventListener("focus",n)})}else{var c=document.querySelector("."+i.tabList);c&&c.classList.add("swiper-wrapper");var s=document.querySelectorAll("."+i.tab);0<s.length&&s.forEach(function(e){e.classList.remove(i.tab+"_active"),e.classList.add("swiper-slide")})}if(document.querySelector(".slider"))new Swiper(".slider",{loop:!0,autoplay:{delay:4e3},pagination:{el:".slider-pagination",type:"bullets",bulletElement:"button",clickable:!0,bulletClass:"slider-pagination__item",bulletActiveClass:"slider-pagination__item_active"}});if(document.body.offsetWidth<=1008&&document.querySelector(".services__slider"))new Swiper(".services__slider",{loop:!0,pagination:{el:".services-pagination",type:"bullets",bulletElement:"button",clickable:!0,bulletClass:"services-pagination__item",bulletActiveClass:"services-pagination__item_active"}});var w={},y={number:10,label:""};if(document.querySelector(".select")){new Select(".select",{idSelect:"#credit-target",classElement:"select__item",classActiveElement:"select__item_selected"});document.querySelector("#credit-target").addEventListener("change",function(e){e.preventDefault();var t=e.target;t.form.reset();function a(e){e.preventDefault(),function(e){var t=document.querySelector("."+e);t.classList.add(e+"_show"),t.querySelector("."+e+"__number").value="№ "+window.util.getCreditNumber(y.number),y.number=y.number+1,t.querySelector("."+e+"__target").value=window.util.toUpperFirstSymbol(_[_.length-1]),t.querySelector("."+e+"__target-label").innerText=w.label,t.querySelector("."+e+"__target-sum").value=window.util.formatPrice(w.currentSum)+" "+w.currency,t.querySelector("."+e+"__initial-sum").value=window.util.formatPrice(w.initialSum)+" "+w.currency,t.querySelector("."+e+"__period").value=w.currentPeriod+" "+window.util.getLabelPeriod(w.currentPeriod,w);var r=t.querySelector("#request-name");r.focus();var a=t.querySelector("#request-phone"),n=t.querySelector("#request-email"),i=!0,o="",l="",c="";try{o=localStorage.getItem("name"),l=localStorage.getItem("phone"),c=localStorage.getItem("email")}catch(e){i=!1}i&&(o&&(r.value=o),l&&(a.value=l),c&&(n.value=c)),t.getElementsByTagName("form")[0].onsubmit=function(e){e.preventDefault();t.classList.remove("request_error"),r.value||r.focus(),r.value&&!a.value&&a.focus(),r.value&&a.value&&!n.value&&n.focus(),r.value&&a.value&&n.value?(i&&(localStorage.setItem("name",r.value),localStorage.setItem("phone",a.value),localStorage.setItem("email",n.value)),window.data.send(new FormData(e.target),function(){window.modal.open("modal-overlay","modal-request")},function(e){})):t.classList.add("request_error")}}("request")}function n(e){var t=document.querySelector("."+e),r=document.querySelector("."+e+"__deny");return 0===w.status?(t.classList.remove(e+"_show"),void r.classList.remove(e+"__deny_show")):d.value<d.minValue?(t.classList.remove(e+"_show"),r.classList.add(e+"__deny_show"),void(r.querySelector(".offer__deny-target").innerText=d.desc)):(t.classList.add(e+"_show"),r.classList.remove(e+"__deny_show"),t.querySelector("."+e+"__label").innerText=d.label,t.querySelector("."+e+"__value").innerText=window.util.formatPrice(d.value)+" "+w.currency,t.querySelector("."+e+"__rate").innerText=(100*d.rate).toFixed(2)+"%",t.querySelector("."+e+"__payment").innerText=window.util.formatPrice(d.payment)+" "+w.currency,t.querySelector("."+e+"__income").innerText=window.util.formatPrice(d.income)+" "+w.currency,void(t.querySelector("."+e+"__link").onclick=a))}function r(){var e,t,r;d.rate=function(){var e=100*w.initialSum/w.currentSum,t={};if(1===w.status)return t={min:.085,max:.094},e<15?t.max:t.min;if(2===w.status)return t={min:.15,max:.16,low:.035,high:.085},w.insuranceCar&&w.insuranceLife?t.low:w.insuranceCar||w.insuranceLife?t.high:w.currentSum<2e6?t.max:t.min;if(3===w.status){t={min:.095,mid:.125,max:.15};var r=0;w.currentSum<75e4&&(r=t.max),75e4<=w.currentSum&&w.currentSum<2e6&&(r=t.mid),2e6<=w.currentSum&&(r=t.min),w.salaryClient&&(r-=.005)}return r}(),d.value=(e=w.initialSum,w.parentCapital&&(e=w.initialSum+w.parentCapitalValue),w.currentSum-e),d.payment=(t=Number((d.rate/12).toFixed(5)),r=12*w.currentPeriod,Math.ceil(d.value*(t+t/(Math.pow(1+t,r)-1)))),d.income=Math.ceil(d.payment/.45),n("offer")}var i=document.querySelector(".calculator__step-second"),o=document.querySelector(".request"),l="none",c="mortgage-loan",s="car-loan",u="consumer-loan",d={};window.credit={update:r};for(var m=0;m<t.children.length;m++)if(t.children[m].hasAttribute("selected"))var p=t.children[m].getAttribute("value"),_=window.util.getDataAttr(t.children[m]);switch(p){case l:w={status:0};break;case c:w={status:1,label:"Стоимость "+_[0].toLowerCase(),minSumTarget:12e5,maxSumTarget:25e6,stepSumTarget:1e5,initialSum:0,percent:.1,percentStep:.05,minPeriod:5,maxPeriod:30,stepPeriod:1,parentCapital:!1,parentCapitalValue:47e4},d={label:"Сумма "+_[1].toLowerCase(),desc:_[2],minValue:5e5};break;case s:w={status:2,label:"Стоимость "+_[0].toLowerCase(),minSumTarget:5e5,maxSumTarget:5e6,stepSumTarget:5e4,initialSum:0,percent:.2,percentStep:.05,minPeriod:1,maxPeriod:5,stepPeriod:1,insuranceCar:!1,insuranceLife:!1},d={label:"Сумма "+_[1].toLowerCase(),desc:_[2],minValue:2e5};break;case u:w={status:3,label:"Сумма "+_[0].toLowerCase(),minSumTarget:5e5,maxSumTarget:3e6,stepSumTarget:5e4,initialSum:0,percent:.1,percentStep:.05,minPeriod:1,maxPeriod:7,stepPeriod:1,salaryClient:!1},d={label:"Сумма "+_[1].toLowerCase()}}if(0!==w.status){if(w.currency="рублей",w.desc="от "+w.minSumTarget+" до "+w.maxSumTarget+" "+w.currency,w.currentSum=w.minSumTarget,w.currentPeriod=w.minPeriod,w.labelPeriod=["год","года","лет"],i.classList.add("calculator__step-show"),document.querySelector(".input-price__sum"))new InputPrice(".input-price__sum",w,{inputEl:"#price-target",descEl:".calculator__input-desc",btnIncrease:".input-price__btn_minus",btnDecrease:".input-price__btn_plus"});if(document.querySelector(".input-price__initial")){new InitialPrice(".input-price__initial",w,{inputEl:"#price-first",rangeEl:".range__price-first",rangeToggleEl:".range__roller",rangeValueEl:".range__value"});document.querySelector("#price-target").addEventListener("change",function(e){e.preventDefault(),window.initialPrice.update()})}if(document.querySelector(".input-price__period"))new Period(".input-price__period",w,{inputEl:"#credit-period",rangeEl:".range__credit-period",rangeToggleEl:".range__roller",rangeValueMinEl:".range__limit-start",rangeValueMaxEl:".range__limit-end"});var v=document.querySelector(".calculator__params");if(v){var g,f=function(e){e.preventDefault(),1===w.status&&(w.parentCapital=e.target.checked),2===w.status&&("insurance-car"===e.target.name&&(w.insuranceCar=e.target.checked),"insurance-life"===e.target.name&&(w.insuranceLife=e.target.checked)),3===w.status&&(w.salaryClient=e.target.checked),r()};v.querySelectorAll(".calculator__param").forEach(function(e){e.classList.remove("calculator__param_show"),function(e){for(var t=0;t<e.length;t++)e[t].onchange=""}(e.getElementsByTagName("input"))}),1===w.status&&(g=v.querySelector(".calculator__param_capital")),2===w.status&&(g=v.querySelector(".calculator__param_insurance")),3===w.status&&(g=v.querySelector(".calculator__param_client")),g.classList.add("calculator__param_show"),function(e,t){for(var r=0;r<e.length;r++)e[r].onchange=t}(g.getElementsByTagName("input"),f)}window.inputPrice.update(),window.initialPrice.update(),window.period.update(),r()}else n("offer"),i.classList.remove("calculator__step-show"),o.classList.remove("request_show")})}function u(){p(d),window.map.update(m)}var d=".map__header",m={},p=function(e){for(var t=document.querySelector(e).getElementsByTagName("input"),r=0;r<t.length;r++){t[r].onchange=u;var a=window.util.getDataAttr(t[r]);m[a]=t[r].checked}};p(d),window.map.update(m)}),ymaps.ready(function(){var e=new ymaps.Map("map",{center:[56.82,60.59],zoom:5,controls:[]}),t=new ymaps.ObjectManager({clusterize:!0,gridSize:5});window.data.load("http://localhost:3000/data.json",function(e){t.add(e)},function(){}),window.map={update:function(r){e.geoObjects.add(t.setFilter(function(e){var t=e.properties.clusterCaption;if(e.properties.clusterCaption===t)return r[t]}))}}}),window.modal={open:function(r,a){var t=function(e){e.preventDefault(),e.keyCode===window.util.KeyCode.ESC&&(n.classList.remove(r+"_show"),i.classList.remove(a+"_show"),document.body.style.overflow="scroll"),window.removeEventListener("keydown",t)},n=document.querySelector("."+r),i=document.querySelector("."+a),e=i.querySelector("."+a+"__close");document.body.style.overflow="hidden",n&&n.classList.add(r+"_show"),i&&(i.classList.add(a+"_show"),e.addEventListener("click",function(e){e.preventDefault();var t=e.target;(t.classList.contains(a+"__close")||t.parentNode.classList.contains(a+"__close")||t.parentNode.parentNode.classList.contains(a+"__close"))&&(n.classList.remove(r+"_show"),i.classList.remove(a+"_show"),document.body.style.overflow="scroll")}),window.addEventListener("keydown",t))}},window.signin={init:function(e,t,r){var a=document.querySelector("."+e),n=a.querySelector("#"+t),i=a.querySelector("#"+r),o=i.parentNode.getElementsByTagName("button")[0],l=!0,c="";try{c=localStorage.getItem("login-name")}catch(e){l=!1}l&&c&&(n.value=c),n.focus(),o&&(o.onmousedown=function(){"password"===i.type&&(i.type="text")},o.onmouseup=function(){"text"===i.type&&(i.type="password")}),a.getElementsByTagName("form")[0].onsubmit=function(){l&&localStorage.setItem("login-name",n.value)}}},function(){var e=navigator.userAgent,t=-1<e.indexOf("MSIE ")||-1<e.indexOf("Trident/");window.util={KeyCode:{ESC:27,ENTER:13},browserIe:t,formatPrice:function(e){return Number(e).toLocaleString("ru-RU")},getDataAttr:function(e){return e.getAttribute("data-value").split(",")},toUpperFirstSymbol:function(e){return e?e[0].toUpperCase()+e.slice(1):"empty"},getLabelPeriod:function(e,t){var r=String(e),a=Number(r[r.length-1]);return 1===a&&11!==e?t.labelPeriod[0]:1<a&&a<5&&12!==e&&13!==e&&14!==e?t.labelPeriod[1]:t.labelPeriod[2]},getCreditNumber:function(e){return"00"+e}}}();